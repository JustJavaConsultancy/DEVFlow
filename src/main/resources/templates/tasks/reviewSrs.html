<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Project Progress - Client Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <!-- Add jsPDF library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
  <style>
    :root {
        --primary: #4f46e5;
        --primary-light: #6366f1;
        --primary-dark: #4338ca;
        --secondary: #10b981;
        --accent: #f59e0b;
    }

    body {
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        background: linear-gradient(135deg, #f0f4ff 0%, #f8fafc 100%);
    }

    .gradient-bg {
        background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
    }

    .card-hover {
        transition: all 0.3s ease;
    }

    .card-hover:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 30px rgba(79, 70, 229, 0.15);
    }

    .progress-transition {
        transition: width 1.5s ease-in-out;
    }

    .priority-high {
        border-left: 4px solid #ef4444;
    }

    .priority-medium {
        border-left: 4px solid #f59e0b;
    }

    .priority-low {
        border-left: 4px solid #10b981;
    }

    .status-completed {
        color: #10b981;
    }

    .status-in-progress {
        color: #3b82f6;
    }

    .status-pending {
        color: #f59e0b;
    }

    .status-blocked {
        color: #ef4444;
    }

    .progress-dot {
        width: 10px;
        height: 10px;
        border-radius: 50%;
        margin-right: 8px;
    }

    .progress-dot.completed {
        background-color: #10b981;
    }

    .progress-dot.current {
        background-color: #3b82f6;
    }

    .progress-dot.upcoming {
        background-color: #d1d5db;
    }

    .document-item {
        transition: all 0.2s ease;
    }

    .document-item:hover {
        background-color: #f3f4f6;
        transform: translateX(5px);
    }

    .activity-item {
        border-left: 3px solid #e5e7eb;
        padding-left: 1rem;
        margin-left: 0.5rem;
    }

    .activity-item:last-child {
        border-left: 3px solid transparent;
    }

    .glow {
        box-shadow: 0 0 20px rgba(79, 70, 229, 0.2);
    }

    .connect-app-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
    }

    .pulse {
        animation: pulse 2s infinite;
    }

    @keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.05); }
        100% { transform: scale(1); }
    }
     .empty-state {
        padding: 3rem 1rem;
        text-align: center;
        color: #6b7280;
    }

    .empty-state-icon {
        font-size: 4rem;
        margin-bottom: 1rem;
        color: #d1d5db;
    }

    .floating {
        animation: floating 3s ease-in-out infinite;
    }

    @keyframes floating {
        0% { transform: translate(0, 0px); }
        50% { transform: translate(0, 10px); }
        100% { transform: translate(0, -0px); }
    }

    /* New styles for equal height grid */
    .grid-container {
        display: flex;
        flex-direction: column;
        min-height: 100vh;
    }

    .equal-height-container {
        display: flex;
        flex-direction: column;
        height: 100%;
    }

    .equal-height-content {
        flex: 1;
        display: flex;
        flex-direction: column;
    }

    .content-scrollable {
        overflow-y: auto;
        max-height: 100%;
    }

    /* Ensure cards take full height of their container */
    .h-full {
        height: 100%;
    }

    /* Custom scrollbar for better appearance */
    .custom-scrollbar::-webkit-scrollbar {
        width: 6px;
    }

    .custom-scrollbar::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 10px;
    }

    .custom-scrollbar::-webkit-scrollbar-thumb {
        background: #c1c1c1;
        border-radius: 10px;
    }

    .custom-scrollbar::-webkit-scrollbar-thumb:hover {
        background: #a8a8a8;
    }
    .shake {
        animation: shake 0.5s ease-in-out;
    }

    @keyframes shake {
        0%, 100% { transform: translateX(0); }
        25% { transform: translateX(-5px); }
        75% { transform: translateX(5px); }
    }

    .completed-tasks-grid {
        display: grid;
        grid-template-columns: repeat(1, 1fr);
        gap: 1.5rem;
    }

    @media (min-width: 768px) {
        .completed-tasks-grid {
            grid-template-columns: repeat(2, 1fr);
        }
    }

    @media (min-width: 1024px) {
        .completed-tasks-grid {
            grid-template-columns: repeat(3, 1fr);
        }
    }

    .completed-task-card {
        border-left: 4px solid #10b981;
        background: linear-gradient(to right, #f0fdf4, #ffffff);
    }

    .completion-badge {
        background-color: #10b981;
        color: white;
    }

    /* Hidden content div for PDF generation */
    #documentContent {
        display: none;
    }
    .invite-section {
        background: rgba(255, 255, 255, 0.8);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(229, 231, 235, 0.8);
        transition: all 0.3s ease;
    }

    .invite-section:hover {
        background: rgba(255, 255, 255, 0.95);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.05);
    }

    .invite-input {
        background: rgba(249, 250, 251, 0.8);
        border: 1px solid rgba(209, 213, 219, 0.6);
        transition: all 0.3s ease;
        width: 100%;
    }

    .invite-input:focus {
        background: white;
        border-color: rgba(79, 70, 229, 0.4);
        box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
    }

    .invite-btn {
        background: rgba(79, 70, 229, 0.9);
        color: white;
        transition: all 0.3s ease;
    }

    .invite-btn:hover {
        background: rgba(79, 70, 229, 1);
        transform: translateY(-1px);
    }

    .invite-btn:disabled {
        background: rgba(156, 163, 175, 0.5);
        cursor: not-allowed;
        transform: none;
    }

    .validation-icon {
        position: absolute;
        right: 12px;
        top: 50%;
        transform: translateY(-50%);
        font-size: 0.875rem;
    }

    .input-wrapper {
        position: relative;
        width: 100%;
    }
    .input-error {
        border-color: #ef4444;
        box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1);
    }

    .input-valid {
        border-color: #10b981;
        box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
    }

    .error-message {
        color: #ef4444;
        font-size: 0.875rem;
        margin-top: 0.5rem;
    }

    .success-message {
        color: #10b981;
        font-size: 0.875rem;
        margin-top: 0.5rem;
    }
  </style>
</head>
<body class="text-gray-800 grid-container">
<!-- Header -->
<header class="gradient-bg text-white shadow-lg">
  <div class="container mx-auto px-4 py-4">
    <div class="flex flex-col md:flex-row justify-between items-center">
      <div class="flex items-center mb-4 md:mb-0">
        <i class="fas fa-code-branch text-2xl mr-3"></i>
        <h1 class="text-xl font-bold">DevFlow</h1>
      </div>

      <div class="flex items-center space-x-4">
        <div class="hidden md:flex items-center space-x-2 bg-white bg-opacity-20 rounded-full px-4 py-2">
          <i class="fas fa-calendar-alt"></i>
          <span id="currentDate"></span>
        </div>
        <div class="bg-white bg-opacity-20 rounded-full px-4 py-2 glow">
          <span  th:text="${'Project: ' + project.processVariables['projectName']}">Project: E-Commerce Platform</span>
        </div>
      </div>
    </div>
  </div>
</header>

<div class="container mx-auto px-4 py-8 flex-1">
  <!-- Invite Section - Positioned outside the grid -->
  <div class="invite-section rounded-xl p-4 mb-8 card-hover">
    <div class="flex flex-col md:flex-row items-center justify-between">
      <div class="flex items-center mb-4 md:mb-0 md:mr-6">
        <div class="w-10 h-10 rounded-full bg-gradient-to-r from-purple-500 to-pink-500 flex items-center justify-center mr-3">
          <i class="fas fa-user-plus text-white text-sm"></i>
        </div>
        <div>
          <h3 class="font-medium text-gray-800">Invite Team Members</h3>
          <p class="text-sm text-gray-600">Share this project with other stakeholders</p>
        </div>
      </div>

      <form class="flex flex-col sm:flex-row w-full md:w-2/3">
        <div class="flex-1 mb-2 sm:mb-0 sm:mr-2">
          <div class="input-wrapper">
            <input
                    type="email"
                    name="email"
                    id="inviteEmail"
                    placeholder="Enter email address"
                    class="invite-input w-full px-4 py-2 rounded-lg text-gray-800 placeholder-gray-500 focus:outline-none"
            >
            <div id="validationIcon" class="validation-icon hidden"></div>
          </div>
          <div id="emailError" class="error-message hidden">
            Please enter a valid email address
          </div>
          <div id="emailSuccess" class="success-message hidden">
            Invitation sent successfully!
          </div>
        </div>
        <button id="sendInviteBtn" class="invite-btn font-medium py-2 px-6 rounded-lg flex items-center justify-center whitespace-nowrap" disabled>
          <i class="fas fa-paper-plane mr-2"></i> Send Invite
        </button>
      </form>
    </div>
  </div>

  <!-- Project Overview -->
  <div class="bg-white rounded-2xl shadow-lg p-6 mb-8 glow">
    <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6">
      <div>
        <h2 th:text="${project.processVariables['projectName']}" class="text-2xl font-bold text-gray-800 mb-2">E-Commerce Platform</h2>
        <p th:text="${project.processVariables['projectDescription']}" class="text-gray-600">Build a full-featured e-commerce platform with payment integration and inventory management.</p>
      </div>
      <div class="mt-4 md:mt-0">
                    <span th:text="${project.processVariables['clientCompanyName']}" class="inline-block bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-medium">
                        <i class="fas fa-building mr-1"></i> Fashion Retail Co.
                    </span>
      </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
      <!-- Project Progress -->
      <div class="md:col-span-2 equal-height-container">
        <h3 class="text-lg font-semibold mb-4 flex items-center">
          <span>Project Progress</span>
          <span th:text="${completedTaskPercentage + '%' + ' Complete'}" class="ml-2 text-sm bg-blue-100 text-blue-800 px-2 py-1 rounded-full">65% Complete</span>
        </h3>

        <div class="mb-6">
          <div class="flex justify-between text-sm text-gray-600 mb-2">
            <span>Overall Progress</span>
            <span th:text="${completedTaskPercentage + '%'}">65%</span>
          </div>
          <div class="w-full bg-gray-200 rounded-full h-3">
            <div class="bg-gradient-to-r from-blue-500 to-purple-600 h-3 rounded-full progress-transition" th:style="'width:' + ${completedTaskPercentage} + '%'"></div>
          </div>
        </div>

        <div class="space-y-4 content-scrollable custom-scrollbar">

          <!-- 1. Planning Phase -->
          <div class="flex items-center">
            <div class="progress-dot"
                 th:classappend="${completedTaskCount >= 2} ? ' completed' :
                             (${completedTaskCount < 2 and completedTaskCount >= 0} ? ' current' : ' upcoming')">
            </div>
            <div class="flex-1">
              <div class="flex justify-between">
                <span class="font-medium">Planning Phase</span>
                <span class="text-sm font-medium"
                      th:classappend="${completedTaskCount >= 2} ? ' text-green-600' :
                                      (${completedTaskCount < 2 and completedTaskCount >= 0} ? ' text-blue-600' : ' text-gray-500')"
                      th:text="${completedTaskCount >= 2 ? 'Completed' :
                               (completedTaskCount < 2 and completedTaskCount >= 0 ? 'In Progress' : 'Upcoming')}">
                </span>
              </div>
              <div class="text-sm text-gray-600 mt-1">Requirements gathering and project planning</div>
            </div>
          </div>

          <!-- 2. Design Phase -->
          <div class="flex items-center">
            <div class="progress-dot"
                 th:classappend="${completedTaskCount >= 4} ? ' completed' :
                             (${completedTaskCount < 4 and completedTaskCount >= 3} ? ' current' : ' upcoming')">
            </div>
            <div class="flex-1">
              <div class="flex justify-between">
                <span class="font-medium">Design Phase</span>
                <span class="text-sm font-medium"
                      th:classappend="${completedTaskCount >= 4} ? ' text-green-600' :
                                      (${completedTaskCount < 4 and completedTaskCount >= 3} ? ' text-blue-600' : ' text-gray-500')"
                      th:text="${completedTaskCount >= 4 ? 'Completed' :
                               (completedTaskCount < 4 and completedTaskCount >= 3 ? 'In Progress' : 'Upcoming')}">
                </span>
              </div>
              <div class="text-sm text-gray-600 mt-1">UI/UX design and prototyping</div>
            </div>
          </div>

          <!-- 3. Development Phase -->
          <div class="flex items-center">
            <div class="progress-dot"
                 th:classappend="${completedTaskCount >= 6} ? ' completed' :
                             (${completedTaskCount < 6 and completedTaskCount >= 5} ? ' current' : ' upcoming')">
            </div>
            <div class="flex-1">
              <div class="flex justify-between">
                <span class="font-medium">Development Phase</span>
                <span class="text-sm font-medium"
                      th:classappend="${completedTaskCount >= 6} ? ' text-green-600' :
                                      (${completedTaskCount < 6 and completedTaskCount >= 5} ? ' text-blue-600' : ' text-gray-500')"
                      th:text="${completedTaskCount >= 6 ? 'Completed' :
                               (completedTaskCount < 6 and completedTaskCount >= 5 ? 'In Progress' : 'Upcoming')}">
                </span>
              </div>
              <div class="text-sm text-gray-600 mt-1">Backend development and API integration</div>
            </div>
          </div>

          <!-- 4. Testing Phase -->
          <div class="flex items-center">
            <div class="progress-dot"
                 th:classappend="${completedTaskCount >= 7} ? ' completed' :
                             (${completedTaskCount == 7} ? ' current' : ' upcoming')">
            </div>
            <div class="flex-1">
              <div class="flex justify-between">
                <span class="font-medium">Testing Phase</span>
                <span class="text-sm font-medium"
                      th:classappend="${completedTaskCount >= 7} ? ' text-green-600' :
                                      (${completedTaskCount == 7} ? ' text-blue-600' : ' text-gray-500')"
                      th:text="${completedTaskCount >= 7 ? 'Completed' :
                               (completedTaskCount == 7 ? 'In Progress' : 'Upcoming')}">
                </span>
              </div>
              <div class="text-sm text-gray-600 mt-1">Quality assurance and user acceptance testing</div>
            </div>
          </div>

          <!-- 5. Launch -->
          <div class="flex items-center">
            <div class="progress-dot"
                 th:classappend="${completedTaskCount == 7} ? ' current' : ' upcoming'">
            </div>
            <div class="flex-1">
              <div class="flex justify-between">
                <span class="font-medium">Launch</span>
                <span class="text-sm font-medium"
                      th:classappend="${completedTaskCount == 7} ? ' text-blue-600' : ' text-gray-500'"
                      th:text="${completedTaskCount == 7 ? 'In Progress' : 'Upcoming'}">
                </span>
              </div>
              <div class="text-sm text-gray-600 mt-1">Deployment and go-live</div>
            </div>
          </div>
        </div>

      </div>

      <!-- Project Details -->
      <div class="equal-height-container">
        <h3 class="text-lg font-semibold mb-4">Project Details</h3>

        <div class="space-y-4 content-scrollable custom-scrollbar">
          <div>
            <div class="text-sm text-gray-500">Start Date</div>
            <div th:text="${#dates.format(project.startTime, 'MMM dd, yyyy')}" class="font-medium">June 15, 2023</div>
          </div>

          <div>
            <div class="text-sm text-gray-500">Estimated Completion</div>
            <div th:text="${project.processVariables['dueDate']}" class="font-medium">November 15, 2023</div>
          </div>

          <div>
            <div class="text-sm text-gray-500">Project Manager</div>
            <div th:text="${project.processVariables['clientName']}" class="font-medium">John Doe</div>
          </div>

          <div>
            <div class="text-sm text-gray-500">Development Team</div>
            <div class="font-medium">7 members</div>
          </div>

          <div>
            <div class="text-sm text-gray-500">Last Updated</div>
            <div class="font-medium">Today</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 equal-height-container">
    <!-- Current Tasks & Activity -->
    <div class="lg:col-span-2 equal-height-content">
      <!-- Connect App Card -->
      <div class="connect-app-card rounded-2xl shadow-lg p-6 mb-8 card-hover h-full">
        <div class="flex flex-col md:flex-row items-center h-full">
          <div class="flex-shrink-0 mb-4 md:mb-0 md:mr-6">
            <div class="w-16 h-16 bg-white bg-opacity-20 rounded-full flex items-center justify-center floating">
              <i class="fas fa-comments text-2xl"></i>
            </div>
          </div>
          <div class="flex-1 text-center md:text-left">
            <h3 class="text-xl font-bold mb-2">Stay Connected with Our App</h3>
            <p class="mb-4 opacity-90">Use our Connect app for real-time messaging, video calls, and quick updates.</p>
            <div class="flex flex-wrap justify-center md:justify-start gap-2 mb-4">
                                <span class="bg-white bg-opacity-20 px-3 py-1 rounded-full text-sm">
                                    <i class="fas fa-comment-dots mr-1"></i> Real-time Messaging
                                </span>
              <span class="bg-white bg-opacity-20 px-3 py-1 rounded-full text-sm">
                                    <i class="fas fa-video mr-1"></i> Video Calls
                                </span>
              <span class="bg-white bg-opacity-20 px-3 py-1 rounded-full text-sm">
                                    <i class="fas fa-bolt mr-1"></i> Quick Updates
                                </span>
            </div>
            <div class="flex space-x-3">
              <a href="https://just-community.up.railway.app/oauth2/authorization/keycloak" class="bg-white text-purple-700 hover:bg-gray-100 font-medium py-2 px-4 rounded-lg transition-colors flex items-center">
                Open Connect
              </a>
            </div>
          </div>
        </div>
      </div>

      <!-- Current Tasks -->
      <div class="bg-white rounded-2xl shadow-lg p-6 mb-8 card-hover h-full">
        <h3 class="text-lg font-semibold mb-4">Current Tasks</h3>

        <div class="space-y-4 content-scrollable custom-scrollbar">
          <!-- Task 1 -->
          <div th:each="task : ${tasks}" th:if="${task.state == 'created'}" class="border border-gray-200 rounded-xl p-4 card-hover priority-high">
            <div class="flex justify-between items-start mb-2">
              <h4 th:text="${task.name}" class="font-medium">Payment Gateway Integration</h4>
              <span class="status-in-progress text-sm font-medium">
                                    <i class="fas fa-circle mr-1"></i> In Progress
                                </span>
            </div>
            <p class="text-sm text-gray-600 mb-3">This is the task currently in progress. We are keeping a close eye on every detail to make sure it meets users expectations and contributes to the overall success of the project</p>
            <div class="flex justify-between items-center text-sm">
              <div class="flex items-center">

              </div>
              <div>
                <span class="text-gray-500">Started:</span>
                <span th:text="${#dates.format(task.createTime, 'MMM dd, yyyy')}" class="ml-1 font-medium">Oct 20, 2023</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Documents & Next Steps -->
    <div class="equal-height-content">
      <!-- Documents -->
      <div class="bg-white rounded-2xl shadow-lg p-6 mb-8 card-hover h-full">
        <h3 class="text-lg font-semibold mb-4">Project Documents</h3>
        <div th:if="${project.processVariables?.['aiRequirementAnalysis'] == null}" class="empty-state">
          <div class="empty-state-icon">
            <i class="fas fa-folder-open"></i>
          </div>
          <h4 class="text-xl font-medium text-gray-500 mb-2">No Documents Available</h4>
          <p class="text-gray-400 mb-4 max-w-md mx-auto">
            Project documents will appear here once they are uploaded by the development team.
          </p>
          <div class="flex flex-col sm:flex-row gap-3 justify-center">
          </div>
        </div>
        <div class="space-y-3 content-scrollable custom-scrollbar">

          <!-- Project Requirements -->
          <div th:if="${project.processVariables?.['aiRequirementAnalysis']}"
               class="document-item flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer">
            <div class="flex-shrink-0 w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center mr-3">
              <i class="fas fa-file-pdf text-blue-600"></i>
            </div>
            <div class="flex-1">
              <input type="hidden" id="requirementSpec" th:value="${project.processVariables?.['aiRequirementAnalysis']}">
              <div class="font-medium">Requirements Specification.pdf</div>
            </div>
            <button onclick="downloadRequirementSpec()"
                    class="text-blue-600 hover:text-blue-800 bg-blue-50 hover:bg-blue-100 p-2 rounded-lg transition-colors">
              <i class="fas fa-download"></i>
            </button>
          </div>

          <!-- Solution Architecture -->
          <div th:if="${project.processVariables?.['architecture']}"
               class="document-item flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer">
            <div class="flex-shrink-0 w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center mr-3">
              <i class="fas fa-file-pdf text-green-600"></i>
            </div>
            <div class="flex-1">
              <input type="hidden" id="architectureSpec" th:value="${project.processVariables?.['architecture']}">
              <div class="font-medium">Solution Architecture.pdf</div>
            </div>
            <button onclick="downloadArchitectureSpec()"
                    class="text-blue-600 hover:text-blue-800 bg-blue-50 hover:bg-blue-100 p-2 rounded-lg transition-colors">
              <i class="fas fa-download"></i>
            </button>
          </div>

        </div>
      </div>
    </div>

  </div>
  <!-- Full Width Completed Tasks Section -->
  <div th:if="${!#lists.isEmpty(completedTasks)}" class="mt-6">
    <div class="bg-white rounded-2xl shadow-lg p-6 card-hover">
      <div class="flex justify-between items-center mb-6">
        <h3 class="text-xl font-bold text-gray-800">Completed Tasks</h3>
        <div class="flex items-center space-x-4">
                        <span class="text-sm text-gray-600">
                            <span th:text="${completedTaskCount}" class="font-semibold text-green-600">32</span> tasks completed
                        </span>
        </div>
      </div>

      <div class="completed-tasks-grid">
        <!-- Completed Task 1 -->
        <div th:each="task : ${completedTasks}" class="completed-task-card border border-gray-200 rounded-xl p-4 card-hover">
          <div class="flex justify-between items-start mb-2">
            <h4 th:text="${task.name}" class="font-medium">User Authentication System</h4>
            <span class="completion-badge text-xs font-medium px-2 py-1 rounded-full">
                                <i class="fas fa-check mr-1"></i> Completed
                            </span>
          </div>
          <p th:if="${task.name == 'Requirement Elicitation'}" class="text-sm text-gray-600 mb-3">
            Gathered and documented client requirements to ensure clear understanding of project goals
          </p>
          <p th:if="${task.name == 'Review The SRS'}" class="text-sm text-gray-600 mb-3">
            Reviewed and validated the Software Requirements Specification to ensure accuracy and completeness
          </p>
          <p th:if="${task.name == 'Review User Stories List'}" class="text-sm text-gray-600 mb-3">
            Reviewed and refined user stories to ensure clarity, completeness, and alignment with project requirements
          </p>

          <p th:if="${task.name == 'Solution Architecture Review'}" class="text-sm text-gray-600 mb-3">
            Evaluated the proposed solution architecture for scalability, security, and alignment with business objectives
          </p>

          <p th:if="${task.name == 'Review Generated Layout'}" class="text-sm text-gray-600 mb-3">
            Assessed the generated UI layouts for usability, consistency, and adherence to design standards
          </p>

          <p th:if="${task.name == 'Review Current User Story Implementation'}" class="text-sm text-gray-600 mb-3">
            Reviewed implemented user stories to verify functionality and ensure alignment with acceptance criteria
          </p>

          <p th:if="${task.name == 'UAT'}" class="text-sm text-gray-600 mb-3">
            Conducted User Acceptance Testing to validate the system against business needs and confirm readiness for deployment
          </p>
          <div class="flex justify-between items-center text-sm">
            <div class="flex items-center">
              <span class="text-gray-500">Completed by:</span>
              <span class="ml-2 font-medium">JustJava Team</span>
            </div>
            <div>
              <span th:text="${#dates.format(task.createTime, 'MMM dd, yyyy')}"  class="text-gray-500">Oct 8, 2023</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Hidden logo for PDF generation -->
<img id="pdfLogo" src="/images/JJ LOGOMARK COLORED.png" alt="Company Logo" style="display: none;">

<!-- Footer -->
<footer class="bg-gray-800 text-white py-6 mt-12">
  <div class="container mx-auto px-4">
    <div class="flex flex-col md:flex-row justify-between items-center">
      <div class="flex items-center mb-4 md:mb-0">
        <i class="fas fa-code-branch text-xl mr-3"></i>
        <span class="font-medium">DevFlow Client Portal</span>
      </div>

      <div class="text-sm text-gray-400 text-center md:text-right">
        This is a read-only view of your project. For any questions, please contact your project manager.
      </div>
    </div>
  </div>
</footer>

<script>
  document.addEventListener('DOMContentLoaded', function() {
  // Email validation and invite functionality
const inviteEmailInput = document.getElementById('inviteEmail');
const sendInviteBtn = document.getElementById('sendInviteBtn');
const emailError = document.getElementById('emailError');
const emailSuccess = document.getElementById('emailSuccess');
const validationIcon = document.getElementById('validationIcon');

function validateEmail(email) {
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  return emailRegex.test(email);
}

function showError() {
  emailError.classList.remove('hidden');
  emailSuccess.classList.add('hidden');
  inviteEmailInput.classList.add('input-error', 'shake');
  inviteEmailInput.classList.remove('input-valid');
  validationIcon.classList.remove('hidden');
  validationIcon.innerHTML = '<i class="fas fa-exclamation-circle text-red-500"></i>';
  sendInviteBtn.disabled = true;

  // Remove shake animation after it completes
  setTimeout(() => {
      inviteEmailInput.classList.remove('shake');
  }, 500);
}

function showSuccess() {
  emailError.classList.add('hidden');
  emailSuccess.classList.remove('hidden');
  inviteEmailInput.classList.remove('input-error');
  inviteEmailInput.classList.add('input-valid');
  validationIcon.classList.remove('hidden');
  validationIcon.innerHTML = '<i class="fas fa-check-circle text-green-500"></i>';
  sendInviteBtn.disabled = false;
}

function validateInput() {
  const email = inviteEmailInput.value.trim();

  if (email === '') {
      // Empty input
      emailError.classList.add('hidden');
      inviteEmailInput.classList.remove('input-error', 'input-valid');
      validationIcon.classList.add('hidden');
      sendInviteBtn.disabled = true;
      return;
  }

  if (!validateEmail(email)) {
      // Invalid email
      showError();
      return;
  }

  // Valid email
  emailError.classList.add('hidden');
  emailSuccess.classList.add('hidden');
  inviteEmailInput.classList.remove('input-error');
  inviteEmailInput.classList.add('input-valid');
  validationIcon.classList.remove('hidden');
  validationIcon.innerHTML = '<i class="fas fa-check-circle text-green-500"></i>';
  sendInviteBtn.disabled = false;
}

// Validate on input
inviteEmailInput.addEventListener('input', validateInput);

// Also validate on Enter key press
inviteEmailInput.addEventListener('keypress', function(e) {
  if (e.key === 'Enter') {
      sendInviteBtn.click();
  }
});

      // Set current date
      const currentDate = new Date();
      const options = { year: 'numeric', month: 'long', day: 'numeric' };
      document.getElementById('currentDate').textContent = currentDate.toLocaleDateString('en-US', options);

      // Animate progress bars
      const progressBars = document.querySelectorAll('.progress-transition');

      progressBars.forEach(bar => {
          const width = bar.style.width;
          bar.style.width = '0';

          setTimeout(() => {
              bar.style.width = width;
          }, 500);
      });

      // Add hover effects to cards
      const cards = document.querySelectorAll('.card-hover');
      cards.forEach(card => {
          card.addEventListener('mouseenter', () => {
              card.classList.add('shadow-lg');
          });

          card.addEventListener('mouseleave', () => {
              card.classList.remove('shadow-lg');
          });
      });

  });

  // Enhanced PDF export with logo and improved formatting
  async function downloadAsPDF(content, filename) {
      const { jsPDF } = window.jspdf;
      const pdf = new jsPDF({
          unit: 'pt',
          format: 'a4',
          compress: true
      });

      const margin = 40;
      const pageHeight = pdf.internal.pageSize.getHeight();
      const pageWidth = pdf.internal.pageSize.getWidth();
      const contentWidth = pageWidth - (2 * margin);
      let y = margin;

      // Add logo to top right corner
      const logo = document.getElementById('pdfLogo');
      if (logo && logo.src) {
          try {
              // Create a canvas to handle the logo
              const canvas = document.createElement('canvas');
              const ctx = canvas.getContext('2d');
              const img = new Image();

              img.onload = function() {
                  // Set logo dimensions
                  const logoWidth = 30;
                  const logoHeight = 50;
                  const logoX = pageWidth - margin - logoWidth;
                  const logoY = margin;

                  // Add logo to PDF
                  pdf.addImage(img, 'PNG', logoX, logoY, logoWidth, logoHeight);

                  // Continue with document content after logo is loaded
                  addDocumentContent();
              };

              img.onerror = function() {
                  console.warn('Logo could not be loaded, proceeding without logo');
                  addDocumentContent();
              };

              img.src = logo.src;

          } catch (error) {
              console.warn('Error loading logo:', error);
              addDocumentContent();
          }
      } else {
          addDocumentContent();
      }

      function addDocumentContent() {
          // Add document header (moved down to accommodate logo)
          y += 40; // Extra space for logo

          // Get project name from the page
          const projectName = document.querySelector('h2.text-2xl')?.textContent || 'Project Document';

          pdf.setFont("helvetica", "bold");
          pdf.setFontSize(16);
          pdf.setTextColor(30, 64, 175); // Blue color
          pdf.text(filename.replace('.pdf', ''), margin, y);

          pdf.setFont("helvetica", "normal");
          pdf.setFontSize(12);
          pdf.setTextColor(100, 100, 100);
          pdf.text(projectName, margin, y + 20);

          y += 50;

          // Create a temporary div to process the content
          const tempDiv = document.createElement('div');
          tempDiv.innerHTML = content;

          // Function to check if we need a page break
          function checkPageBreak(heightNeeded = 0) {
              if (y + heightNeeded > pageHeight - margin) {
                  pdf.addPage();
                  y = margin;
                  // Add logo to new page
                  const logo = document.getElementById('pdfLogo');
                  if (logo && logo.src) {
                      try {
                          const img = new Image();
                          img.onload = function() {
                              const logoWidth = 30;
                              const logoHeight = 50;
                              const logoX = pageWidth - margin - logoWidth;
                              pdf.addImage(img, 'PNG', logoX, margin, logoWidth, logoHeight);
                          };
                          img.src = logo.src;
                      } catch (error) {
                          console.warn('Could not add logo to new page');
                      }
                  }
                  return true;
              }
              return false;
          }

          // Function to add text with proper formatting
          function addText(text, fontSize = 12, isBold = false, indent = 0, lineHeight = 1.4, color = [55, 65, 81]) {
              pdf.setFont("helvetica", isBold ? "bold" : "normal");
              pdf.setFontSize(fontSize);
              pdf.setTextColor(...color);

              const lines = pdf.splitTextToSize(text, contentWidth - indent);
              const lineSpacing = fontSize * lineHeight;

              // Check if we need a page break before adding this text
              checkPageBreak(lines.length * lineSpacing);

              lines.forEach((line, index) => {
                  // Check if we need a page break for each line
                  if (y + lineSpacing > pageHeight - margin) {
                      pdf.addPage();
                      y = margin;
                  }

                  pdf.text(line, margin + indent, y);
                  y += lineSpacing;
              });

              // Add a small gap after the text block
              y += 5;
          }

          // Process each node in the content
          function processNode(node) {
              if (node.nodeType === Node.TEXT_NODE) {
                  if (node.textContent.trim()) {
                      // Check if parent is bold
                      const parent = node.parentElement;
                      const isBold = parent && (
                              parent.tagName === 'STRONG' ||
                              parent.tagName === 'B' ||
                              parent.style.fontWeight === 'bold'
                      );
                      addText(node.textContent.trim(), 12, isBold);
                  }
              } else if (node.nodeType === Node.ELEMENT_NODE) {
                  const tag = node.tagName.toLowerCase();
                  const textContent = node.textContent.trim();

                  if (!textContent) return;

                  switch(tag) {
                      case "h1":
                          addText(textContent, 18, true, 0, 1.4, [30, 64, 175]);
                          y += 10;
                          break;

                      case "h2":
                          addText(textContent, 16, true, 0, 1.4, [120, 10, 255]);
                          y += 8;
                          break;

                      case "h3":
                          addText(textContent, 14, true, 0, 1.4, [75, 123, 236]);
                          y += 8;
                          break;

                      case "h4":
                          addText(textContent, 13, true, 0, 1.4, [75, 85, 99]);
                          y += 6;
                          break;

                      case "p":
                          addText(textContent, 12, false);
                          break;

                      case "li":
                          const isOrdered = node.parentElement && node.parentElement.tagName === 'OL';
                          const prefix = isOrdered ?
                                  (Array.from(node.parentElement.children).indexOf(node) + 1) + '. ' : '• ';
                          addText(prefix + textContent, 12, false, 20);
                          break;

                      case "ul":
                      case "ol":
                          y += 8;
                          Array.from(node.children).forEach(child => processNode(child));
                          y += 8;
                          break;

                      case "strong":
                      case "b":
                          Array.from(node.childNodes).forEach(child => {
                              if (child.nodeType === Node.TEXT_NODE) {
                                  addText(child.textContent.trim(), 12, true);
                              } else {
                                  processNode(child);
                              }
                          });
                          break;

                      case "table":
                          processTable(node);
                          break;

                      case "div":
                          if (node.classList.contains('component-box')) {
                              processComponentBox(node);
                          } else if (node.classList.contains('architecture-diagram')) {
                              processArchitectureDiagram(node);
                          } else {
                              Array.from(node.childNodes).forEach(processNode);
                          }
                          break;

                      default:
                          Array.from(node.childNodes).forEach(processNode);
                  }
              }
          }

          // Process tables with simplified styling
          function processTable(table) {
              const rows = [];
              table.querySelectorAll("tr").forEach(tr => {
                  const row = [];
                  tr.querySelectorAll("td, th").forEach(cell => {
                      row.push({
                          content: cell.innerText.trim(),
                          isHeader: cell.tagName === 'TH'
                      });
                  });
                  rows.push(row);
              });

              if (rows.length > 0) {
                  checkPageBreak(100); // Reserve space for table

                  const columnWidths = Array(rows[0].length).fill(contentWidth / rows[0].length);
                  const startY = y;

                  // Draw table header (simplified - no background color)
                  const headerRow = rows[0];
                  const rowHeight = 25;

                  // Draw header text (no background)
                  pdf.setFont("helvetica", "bold");
                  pdf.setFontSize(10);
                  pdf.setTextColor(55, 65, 81); // Regular text color instead of white

                  headerRow.forEach((cell, index) => {
                      const x = margin + (index * columnWidths[index]);
                      const cellContent = pdf.splitTextToSize(cell.content, columnWidths[index] - 10);
                      pdf.text(cellContent, x + 5, y + 15);
                  });

                  y += rowHeight;

                  // Draw table rows (simplified - no alternating colors)
                  pdf.setFont("helvetica", "normal");
                  pdf.setFontSize(10);
                  pdf.setTextColor(55, 65, 81);

                  for (let i = 1; i < rows.length; i++) {
                      checkPageBreak(rowHeight);

                      const row = rows[i];
                      row.forEach((cell, index) => {
                          const x = margin + (index * columnWidths[index]);
                          const cellContent = pdf.splitTextToSize(cell.content, columnWidths[index] - 10);
                          pdf.text(cellContent, x + 5, y + 15);
                      });

                      y += rowHeight;
                  }

                  y += 20;
              }
          }

          // Process component boxes
          function processComponentBox(box) {
              checkPageBreak(40);

              pdf.setFont("helvetica", "bold");
              pdf.setFontSize(11);
              pdf.setTextColor(55, 65, 81);

              const text = pdf.splitTextToSize(box.textContent, contentWidth - 20);
              pdf.text(text, margin + 10, y + 18);

              y += 40;
          }

          // Process architecture diagrams
          function processArchitectureDiagram(diagram) {
              checkPageBreak(100);

              pdf.setFont("helvetica", "bold");
              pdf.setFontSize(12);
              pdf.setTextColor(100, 100, 100);
              pdf.text("Architecture Diagram", pageWidth / 2, y + 45, { align: 'center' });

              y += 100;
          }

          // Process all content nodes
          Array.from(tempDiv.childNodes).forEach(processNode);

          // Add page numbers to footer
          const pageCount = pdf.internal.getNumberOfPages();
          for (let i = 1; i <= pageCount; i++) {
              pdf.setPage(i);
              pdf.setFontSize(10);
              pdf.setTextColor(150);
              pdf.text(`Page ${i} of ${pageCount}`, pageWidth - margin, pageHeight - 20, { align: "right" });
          }

          // Save the PDF
          pdf.save(filename);
      }
  }

  // Function to download requirement specification
  function downloadRequirementSpec() {
      const content = document.getElementById('requirementSpec').value;
      downloadAsPDF(content, "requirements-specification.pdf");
  }

  // Function to download architecture specification
  function downloadArchitectureSpec() {
      const content = document.getElementById('architectureSpec').value;
      downloadAsPDF(content, "solution-architecture.pdf");
  }
</script>
</body>
</html>