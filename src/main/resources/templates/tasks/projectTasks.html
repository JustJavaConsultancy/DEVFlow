<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tasks</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    .task-priority-high { border-left: 4px solid #e53e3e; }
    .task-priority-medium { border-left: 4px solid #dd6b20; }
    .task-priority-low { border-left: 4px solid #38a169; }

    .task-status-todo { background-color: #ebf8ff; color: #3182ce; }
    .task-status-inprogress { background-color: #fff5eb; color: #dd6b20; }
    .task-status-review { background-color: #faf5ff; color: #805ad5; }
    .task-status-completed { background-color: #f0fff4; color: #38a169; }

    .completed-task {
      opacity: 0.8;
      background-color: #f9fafb;
    }
    .completed-task h3 { text-decoration: line-through; color: #9ca3af !important; }
    .completed-task p { color: #9ca3af !important; }
  </style>
</head>
<body>
<div layout:fragment="content">

  <!-- Page Title -->
  <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8">
    <h1 class="text-2xl md:text-3xl font-bold text-blue-800 mb-4 md:mb-0">
      <i class="fas fa-tasks mr-3 text-blue-600"></i>
      Task Management
    </h1>
  </div>

  <!-- Current Task Section -->
  <div class="mb-8" th:if="${#lists.isEmpty(tasks) == false}">
    <h2 class="text-xl font-bold text-blue-800 mb-4 flex items-center">
      <i class="fas fa-star mr-2 text-yellow-500"></i>
      Current Task
    </h2>

    <!-- Show only tasks with state CREATED -->
    <div th:each="task : ${tasks}" th:if="${task.state == 'created'}"
         class="bg-white border border-gray-200 rounded-xl p-5 card-hover shadow-sm"
         >

      <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-4">
        <div>
          <h3 class="font-bold text-blue-700 text-lg md:text-xl mb-1"
              th:text="${task.name}">Task Name</h3>
          <div class="flex items-center flex-wrap gap-2">
            <span class="text-xs px-2 py-1 task-status-inprogress rounded-full"
                  >In Progress</span>
          </div>
        </div>

        <div class="flex items-center mt-3 md:mt-0">
          <span class="text-sm text-gray-600"
                th:text="${'Created Date: ' + task.createTime}">Due:</span>
        </div>
      </div>

      <p class="text-gray-600 text-sm mb-4"
         >This is the task currently in progress. It requires immediate attention and active work to move the project forward. Review the details and complete the pending steps to ensure the task is finished on time</p>
      <div class="flex flex-wrap items-center justify-between gap-4">
        <div class="flex items-center">
          <div class="mr-4">
            <span class="text-xs text-gray-500 block">Progress:</span>
            <span class="text-xs text-gray-500"
                  >Not Started</span>
          </div>
        </div>

        <div class="flex space-x-2">
          <a th:href="@{/tasks/view/{taskId}(taskId=${task.id})}" class="gradient-bg text-white px-4 py-2 rounded-lg text-sm flex items-center">
            <i class="fas fa-hand-paper mr-1"></i> Claim Task
          </a>
        </div>
      </div>
    </div>
  </div>

  <!-- Completed Tasks Section -->
  <div th:if="${!#lists.isEmpty(completedTasks)}">
    <h2 class="text-xl font-bold text-blue-800 mb-4 flex items-center">
      <i class="fas fa-check-circle mr-2 text-green-600"></i>
      Completed Tasks
    </h2>

    <div class="grid grid-cols-1 gap-4">
      <a th:href="@{/tasks/viewCompleted/{taskId}(taskId=${task.id})}" th:each="task : ${completedTasks}"
           class="completed-task border border-gray-200 rounded-xl p-4 card-hover shadow-sm">


        <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-3">
          <div>
            <h3 class="font-bold text-base md:text-lg mb-1"
                th:text="${task.name}">Completed Task</h3>
            <div class="flex items-center flex-wrap gap-2">
              <span class="text-xs px-2 py-1 task-status-completed rounded-full">Completed</span>
            </div>
          </div>
          <div class="flex items-center mt-2 md:mt-0">
            <span class="text-sm text-gray-400">Completed: --</span>
          </div>
        </div>

        <p class="text-gray-600 text-sm mb-4">
          This task has been successfully completed. All requirements were met, and the deliverables are finalized.
          No further action is required.
        </p>

        <div class="flex justify-between items-center">
          <div class="flex items-center">
            <i class="fas fa-code-branch text-gray-400"></i>
          </div>
          <div class="text-xs text-gray-400" th:text="${'Created Date: ' + task.createTime}">Created: --</div>
        </div>
      </a>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Animate progress bars
      const bars = document.querySelectorAll('.progress-transition');
      bars.forEach(bar => {
        const width = bar.style.width;
        bar.style.width = '0';
        setTimeout(() => bar.style.width = width, 500);
      });
    });
  </script>
</div>
</body>
</html>
