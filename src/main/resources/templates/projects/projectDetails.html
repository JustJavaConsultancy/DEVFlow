<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Project Details</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <!-- Add HTMX -->
  <script src="https://unpkg.com/htmx.org@1.9.10"></script>
  <style>
    .modal {
      transition: opacity 0.3s ease, transform 0.3s ease;
      transform: scale(0.9);
      opacity: 0;
      visibility: hidden;
    }

    .modal.active {
      transform: scale(1);
      opacity: 1;
      visibility: visible;
    }

    .input-focus:focus {
      border-color: #780aff;
      box-shadow: 0 0 0 3px rgba(120, 10, 255, 0.2);
    }

    .requirements-container {
      max-height: 120px;
      overflow: hidden;
      transition: max-height 0.5s ease;
    }

    .requirements-container.expanded {
      max-height: 1000px;
    }

    .show-more-btn {
      color: #780aff;
      cursor: pointer;
      font-size: 0.875rem;
      font-weight: 500;
    }

    .show-more-btn:hover {
      text-decoration: underline;
    }

    .invite-section {
      background: rgba(255, 255, 255, 0.8);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(229, 231, 235, 0.8);
      transition: all 0.3s ease;
    }

    .invite-section:hover {
      background: rgba(255, 255, 255, 0.95);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.05);
    }

    .invite-input {
      background: rgba(249, 250, 251, 0.8);
      border: 1px solid rgba(209, 213, 219, 0.6);
      transition: all 0.3s ease;
      width: 100%;
    }

    .invite-input:focus {
      background: white;
      border-color: rgba(79, 70, 229, 0.4);
      box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
    }

    .invite-btn {
      background: rgba(79, 70, 229, 0.9);
      color: white;
      transition: all 0.3s ease;
      min-width: 120px; /* Fixed width to prevent size changes */
    }

    .invite-btn:hover {
      background: rgba(79, 70, 229, 1);
      transform: translateY(-1px);
    }

    .invite-btn:disabled {
      background: rgba(156, 163, 175, 0.5);
      cursor: not-allowed;
      transform: none;
    }

    .validation-icon {
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 0.875rem;
    }

    .input-wrapper {
      position: relative;
      width: 100%;
    }

    .input-error {
      border-color: #ef4444;
      box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1);
    }

    .input-valid {
      border-color: #10b981;
      box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
    }

    .error-message {
      color: #ef4444;
      font-size: 0.875rem;
      margin-top: 0.5rem;
    }

    .success-message {
      color: #10b981;
      font-size: 0.875rem;
      margin-top: 0.5rem;
    }

    /* Validation styles */
    .input-valid { border-color: #10b981 !important; }
    .input-invalid { border-color: #ef4444 !important; }
    .validation-message { font-size: 0.75rem; margin-top: 0.25rem; display: flex; align-items: center; }
    .validation-error { color: #ef4444; }
    .validation-success { color: #10b981; }
    .validation-icon { margin-right: 0.25rem; }

    /* Animation for shake effect */
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
      20%, 40%, 60%, 80% { transform: translateX(5px); }
    }

    .shake {
      animation: shake 0.5s ease-in-out;
    }

    /* HTMX loading states */
    .htmx-request .btn-loading {
      opacity: 0.7;
      cursor: not-allowed;
    }

    .htmx-request .spinner {
      display: inline-block;
    }

    .spinner {
      display: none;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    /* Message fade out animation */
    .message-fade-out {
      animation: fadeOut 0.5s ease-in-out forwards;
      animation-delay: 3s;
    }

    @keyframes fadeOut {
      from { opacity: 1; }
      to { opacity: 0; visibility: hidden; }
    }

    /* Invite result container styling */
    #invite-result {
      position: relative;
      width: 100%;
      z-index: 10;
      margin-top: 0.5rem;
    }

    /* Invite message styles */
    .invite-message {
      padding: 0.75rem 1rem;
      border-radius: 0.5rem;
      font-size: 0.875rem;
      font-weight: 500;
      animation: slideIn 0.3s ease-out;
      display: flex;
      align-items: center;
    }

    .invite-success {
      background-color: #f0fdf4;
      border: 1px solid #bbf7d0;
      color: #166534;
    }

    .invite-error {
      background-color: #fef2f2;
      border: 1px solid #fecaca;
      color: #991b1b;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
  </style>
</head>
<body>
<div layout:fragment="content" id="project-details">
  <!-- Back Button -->
  <div class="mb-6">
    <a href="#" onclick="window.history.back(); return false;"
       class="text-blue-600 hover:text-blue-800 flex items-center">
      <i class="fas fa-arrow-left mr-2"></i> Back to Projects
    </a>
  </div>

  <!-- Project Details Section -->
  <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
    <!-- Project Info Card -->
    <div class="lg:col-span-2 bg-white border border-gray-200 rounded-xl p-5 md:p-6 card-hover shadow-sm">
      <div class="flex justify-between items-center mb-4">
        <h1 class="text-2xl md:text-3xl font-bold text-blue-800" th:text="${project.processVariables['projectName']}">E-Commerce Platform</h1>
        <span th:if="${project.processVariables['progress'] < 4}" class="bg-yellow-100 text-yellow-700 text-xs px-2 md:px-3 py-1 rounded-full">Documentation</span>
        <span th:if="${project.processVariables['progress'] == 4}" class="bg-blue-100 text-blue-700 text-xs px-2 md:px-3 py-1 rounded-full">Development</span>
        <span th:if="${project.processVariables['progress'] > 4}" class="bg-green-100 text-green-700 text-xs px-2 md:px-3 py-1 rounded-full">Testing</span>
      </div>

      <p class="text-gray-600 mb-6" th:text="${project.processVariables['projectDescription']}">
        Build a full-featured e-commerce platform with payment integration and inventory management.
        The platform will include user authentication, product catalog, shopping cart, checkout process,
        and admin dashboard for managing products and orders.
      </p>

      <div class="w-full bg-gray-200 rounded-full h-2.5 mb-4">
        <div class="bg-blue-600 h-2.5 rounded-full progress-transition" th:style="|width:${((project.processVariables['progress'] ?: 0) * 100) / 7}%|"></div>
      </div>

      <div class="flex justify-between text-sm text-gray-500 mb-6">
        <span th:text="${project.processVariables['progress']} + '/7' + ' Tasks Completed'">0/6 tasks completed</span>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="flex items-center">
          <div class="bg-blue-100 p-3 rounded-lg mr-3">
            <i class="fas fa-calendar text-blue-600"></i>
          </div>
          <div>
            <p class="text-sm text-gray-500">Start Date</p>
            <p class="font-medium" th:text="${project.startTime}">Oct 1, 2023</p>
          </div>
        </div>

        <div class="flex items-center">
          <div class="bg-blue-100 p-3 rounded-lg mr-3">
            <i class="fas fa-flag text-blue-600"></i>
          </div>
          <div>
            <p class="text-sm text-gray-500">Priority</p>
            <p class="font-medium">High</p>
          </div>
        </div>

        <div class="flex items-center">
          <div class="bg-blue-100 p-3 rounded-lg mr-3">
            <i class="fas fa-dollar-sign text-blue-600"></i>
          </div>
          <div>
            <p class="text-sm text-gray-500">Budget</p>
            <p class="font-medium">$0</p>
          </div>
        </div>

        <div class="flex items-center">
          <div class="bg-blue-100 p-3 rounded-lg mr-3">
            <i class="fas fa-user-friends text-blue-600"></i>
          </div>
          <div>
            <p class="text-sm text-gray-500">Team Size</p>
            <p class="font-medium">7 Members</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Client Info Card -->
    <div class="bg-white border border-gray-200 rounded-xl p-5 md:p-6 card-hover shadow-sm">
      <h2 class="text-xl font-bold text-blue-800 mb-4">Client Information</h2>

      <div class="flex items-center mb-4">
        <!-- Profile Circle with Client Initial -->
        <div class="w-16 h-16 rounded-full bg-blue-100 flex items-center justify-center mr-4">
          <span th:text="${#strings.substring(project.processVariables['clientName'],0,1)}"
                class="text-blue-800 font-bold text-2xl">
            S
          </span>
        </div>

        <!-- Client Name and Company -->
        <div>
          <h3 th:text="${project.processVariables['clientName']}" class="font-bold text-lg">Sarah Johnson</h3>
          <p th:text="${project.processVariables['clientCompanyName']}" class="text-gray-600">Fashion Retail Co.</p>
        </div>
      </div>

      <div class="space-y-3">
        <div class="flex items-center">
          <div class="bg-blue-100 p-2 rounded-lg mr-3">
            <i class="fas fa-envelope text-blue-600"></i>
          </div>
          <div>
            <p class="text-sm text-gray-500">Email</p>
            <p th:text="${project.processVariables['clientEmail']}"
               class="font-medium"
               style="word-break: break-word; overflow-wrap: break-word;">
              sarah@fashionretail.co
            </p>
          </div>
        </div>

        <div class="flex items-center">
          <div class="bg-blue-100 p-2 rounded-lg mr-3">
            <i class="fas fa-phone text-blue-600"></i>
          </div>
          <div>
            <p class="text-sm text-gray-500">Phone</p>
            <p th:text="${project.processVariables['clientPhonenumber']}" class="font-medium">(555) 123-4567</p>
          </div>
        </div>

        <div class="flex items-center">
          <div class="bg-blue-100 p-2 rounded-lg mr-3">
            <i class="fas fa-map-marker-alt text-blue-600"></i>
          </div>
          <div>
            <p class="text-sm text-gray-500">Location</p>
            <p th:text="${project.processVariables['clientAddress']}" class="font-medium">New York, NY</p>
          </div>
        </div>
      </div>

      <div class="mt-6 pt-4 border-t border-gray-200">
        <h3 class="font-medium text-blue-800 mb-2">Client Requirements</h3>
        <div id="requirements-container" class="requirements-container">
          <ul class="list-disc pl-5 text-sm text-gray-600 space-y-1" id="requirements-list">
            <!-- Requirements will be populated by JavaScript -->
          </ul>
        </div>
        <div id="show-more-btn" class="show-more-btn mt-2">Show more</div>
      </div>
    </div>
  </div>

  <!-- Current Task Section -->
  <div th:each="task : ${tasks}" th:if="${task.state == 'created'}" class="bg-white border border-gray-200 rounded-xl p-5 md:p-6 card-hover shadow-sm mb-8">
    <h2 class="text-xl font-bold text-blue-800 mb-4">Current Task</h2>

    <div class="bg-blue-50 border border-blue-100 rounded-lg p-4 md:p-5">
      <div class="flex justify-between items-start mb-3">
        <h3 th:text="${task.name}" class="text-lg font-bold text-blue-800">Payment Gateway Integration</h3>
        <span class="bg-blue-100 text-blue-700 text-xs px-3 py-1 rounded-full">In Progress</span>
      </div>

      <p class="text-gray-600 mb-4">
        This is the task currently in progress. We are keeping a close eye on every detail to make sure it meets users expectations and contributes to the overall success of the project
      </p>

      <div class="flex justify-between text-xs text-gray-500 mb-4">
        <span th:text="${'Started: ' + task.createTime}">Started: Oct 20, 2023</span>
      </div>

    </div>
  </div>

  <!-- Project URL Section -->
  <div class="bg-white border border-gray-200 rounded-xl p-5 md:p-6 card-hover shadow-sm mb-8">
    <h2 class="text-xl font-bold text-blue-800 mb-4">Project URL</h2>

    <p class="text-gray-600 mb-6">
      Add the live URL for your project to make it accessible to team members and clients.
      This will be displayed on the project dashboard and shared with stakeholders.
    </p>

    <form th:action="@{~/project/save-url}" method="post" id="url-form">
      <div class="w-full">
        <label for="project-url" class="block text-sm font-medium text-gray-700 mb-2">
          Project URL
        </label>
        <div class="flex flex-col md:flex-row items-stretch md:items-center gap-3">
          <div class="relative flex-1">
            <span class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
              <i class="fas fa-link text-gray-400"></i>
            </span>
            <input type="url"
                   id="project-url"
                   name="projectUrl"
                   th:value="${project.processVariables['projectURL'] ?: ''}"
                   placeholder="https://www.example.com"
                   class="pl-10 w-full border border-gray-300 rounded-lg py-3 px-4 input-focus focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200">
          </div>
          <input type="hidden" name="projectId" th:value="${projectId}">
          <button id="save-url-btn"
                  type="submit"
                  class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg transition-colors duration-200 flex items-center justify-center whitespace-nowrap disabled:bg-blue-400 disabled:cursor-not-allowed"
                  disabled>
            <i class="fas fa-save mr-2"></i> Save URL
          </button>
        </div>
        <div id="url-validation-message" class="validation-message mt-2"></div>
        <p class="text-xs text-gray-500 mt-2">
          Enter the full URL including <code>https://</code>
        </p>
      </div>
    </form>
  </div>

  <!-- Invite Section - Positioned outside the grid -->
  <div class="invite-section rounded-xl p-4 mb-8 card-hover">
    <div class="flex flex-col md:flex-row items-center justify-between">
      <div class="flex items-center mb-4 md:mb-0 md:mr-6">
        <div class="w-10 h-10 rounded-full bg-gradient-to-r from-purple-500 to-pink-500 flex items-center justify-center mr-3">
          <i class="fas fa-user-plus text-white text-sm"></i>
        </div>
        <div>
          <h3 class="font-medium text-gray-800">Invite Team Members</h3>
          <p class="text-sm text-gray-600">Share this project with other stakeholders</p>
        </div>
      </div>

      <!-- Updated form with HTMX -->
      <div class="w-full md:w-2/3">
        <form id="inviteForm"
              class="flex flex-col sm:flex-row w-full"
              hx-post="/project/invite"
              hx-target="#invite-result"
              hx-swap="innerHTML"
              hx-trigger="submit"
              hx-indicator="#invite-spinner">
          <div class="flex-1 mb-2 sm:mb-0 sm:mr-2 relative">
            <div class="input-wrapper">
              <input
                      type="email"
                      name="email"
                      id="inviteEmail"
                      placeholder="Enter email address"
                      class="invite-input w-full px-4 py-2 rounded-lg text-gray-800 placeholder-gray-500 focus:outline-none"
                      required
              >
              <div id="validationIcon" class="validation-icon hidden"></div>
            </div>
            <input type="hidden" name="projectId" th:value="${projectId}" />
            <!-- CSRF Token -->
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
          </div>
          <button id="sendInviteBtn"
                  class="invite-btn font-medium py-2 px-6 rounded-lg flex
                  items-center justify-center whitespace-nowrap btn-loading"
                  type="submit"
                  disabled>
            <i class="fas fa-paper-plane mr-2"></i>
            <span class="spinner" id="invite-spinner">
              <i class="fas fa-spinner"></i>
            </span>
            <span class="btn-text">Send Invite</span>
          </button>
        </form>

        <!-- Result container for HTMX response - Now positioned below the form -->
        <div id="invite-result"></div>
      </div>
    </div>
  </div>

  <!-- Action Buttons -->
  <div class="flex flex-wrap gap-3">
    <button id="delete-project-btn" class="border border-red-600 text-red-600 px-4 py-2 rounded-lg">
      <i class="fas fa-trash mr-2"></i> Delete Project
    </button>
  </div>

  <!-- Delete Confirmation Modal -->
  <div id="delete-modal" class="modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white rounded-xl p-6 md:p-8 max-w-md w-full mx-4">
      <div class="flex items-center mb-4">
        <div class="bg-red-100 p-3 rounded-full mr-4">
          <i class="fas fa-exclamation-triangle text-red-600 text-xl"></i>
        </div>
        <h3 class="text-xl font-bold text-gray-800">Delete Project</h3>
      </div>

      <p class="text-gray-600 mb-6">
        Are you sure you want to delete the "E-Commerce Platform" project? This action cannot be undone and all associated data will be permanently removed.
      </p>

      <div class="flex justify-end space-x-3">
        <button id="cancel-delete" class="border border-gray-300 text-gray-700 px-4 py-2 rounded-lg">
          Cancel
        </button>
        <form id="delete-project-form" th:action="@{~/project/delete}" method="post">
          <input type="hidden" name="projectId" th:value="${projectId}">
          <!-- CSRF Token -->
          <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
          <button id="confirm-delete" type="submit" class="bg-red-600 text-white px-4 py-2 rounded-lg">
            Delete Project
          </button>
        </form>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Email validation and invite functionality
      const inviteEmailInput = document.getElementById('inviteEmail');
      const sendInviteBtn = document.getElementById('sendInviteBtn');
      const validationIcon = document.getElementById('validationIcon');
      const inviteForm = document.getElementById('inviteForm');
      const inviteResult = document.getElementById('invite-result');

      // URL validation elements
      const urlInput = document.getElementById('project-url');
      const saveButton = document.getElementById('save-url-btn');
      const validationMessage = document.getElementById('url-validation-message');
      const urlForm = document.getElementById('url-form');

      // URL validation function
      function isValidURL(string) {
        try {
          const url = new URL(string);
          // Check if protocol is http or https
          return url.protocol === 'http:' || url.protocol === 'https:';
        } catch (_) {
          return false;
        }
      }

      // Validate URL in real-time
      urlInput.addEventListener('input', function() {
        const url = urlInput.value.trim();

        // Clear previous validation state
        urlInput.classList.remove('input-valid', 'input-invalid');
        validationMessage.textContent = '';
        validationMessage.className = 'validation-message';

        // If empty, show no validation and disable button
        if (!url) {
          saveButton.disabled = true;
          return;
        }

        // Validate URL
        if (isValidURL(url)) {
          // Valid URL
          urlInput.classList.add('input-valid');
          validationMessage.innerHTML = '<i class="fas fa-check-circle validation-icon"></i> Valid URL format';
          validationMessage.classList.add('validation-success');
          saveButton.disabled = false;
        } else {
          // Invalid URL
          urlInput.classList.add('input-invalid');
          validationMessage.innerHTML = '<i class="fas fa-exclamation-circle validation-icon"></i> Please enter a valid URL (e.g., https://example.com)';
          validationMessage.classList.add('validation-error');
          saveButton.disabled = true;
        }
      });

      // Initialize URL validation if there's already a value
      if (urlInput.value.trim()) {
        urlInput.dispatchEvent(new Event('input'));
      }

      // Email validation functions
      function validateEmail(email) {
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        return emailRegex.test(email);
      }

      function showError() {
        inviteEmailInput.classList.add('input-error', 'shake');
        inviteEmailInput.classList.remove('input-valid');
        validationIcon.classList.remove('hidden');
        validationIcon.innerHTML = '<i class="fas fa-exclamation-circle text-red-500"></i>';
        sendInviteBtn.disabled = true;

        // Remove shake animation after it completes
        setTimeout(() => {
          inviteEmailInput.classList.remove('shake');
        }, 500);
      }

      function showSuccess() {
        inviteEmailInput.classList.remove('input-error');
        inviteEmailInput.classList.add('input-valid');
        validationIcon.classList.remove('hidden');
        validationIcon.innerHTML = '<i class="fas fa-check-circle text-green-500"></i>';
        sendInviteBtn.disabled = false;
      }

      function validateInput() {
        const email = inviteEmailInput.value.trim();

        if (email === '') {
          // Empty input
          inviteEmailInput.classList.remove('input-error', 'input-valid');
          validationIcon.classList.add('hidden');
          sendInviteBtn.disabled = true;
          return;
        }

        if (!validateEmail(email)) {
          // Invalid email
          showError();
          return;
        }

        // Valid email
        inviteEmailInput.classList.remove('input-error');
        inviteEmailInput.classList.add('input-valid');
        validationIcon.classList.remove('hidden');
        validationIcon.innerHTML = '<i class="fas fa-check-circle text-green-500"></i>';
        sendInviteBtn.disabled = false;
      }

      // Validate on input
      inviteEmailInput.addEventListener('input', validateInput);

      // Function to auto-dismiss messages
      function autoDismissMessage(element) {
        if (element) {
          // Add fade-out animation class
          element.classList.add('message-fade-out');

          // Remove element after animation completes
          setTimeout(() => {
            if (element.parentNode) {
              element.parentNode.removeChild(element);
            }
          }, 3500); // 3.5 seconds total (3s delay + 0.5s animation)
        }
      }

      // Progress bars animation
      const progressBars = document.querySelectorAll('.progress-transition');

      // Reset widths for animation
      progressBars.forEach(bar => {
        const width = bar.style.width;
        bar.style.width = '0';

        // Animate after a short delay
        setTimeout(() => {
          bar.style.width = width;
        }, 500);
      });

      // Add hover effect to cards
      const cards = document.querySelectorAll('.card-hover');
      cards.forEach(card => {
        card.addEventListener('mouseenter', () => {
          card.classList.add('shadow-lg');
        });

        card.addEventListener('mouseleave', () => {
          card.classList.remove('shadow-lg');
        });
      });

      // Delete confirmation modal functionality
      const deleteProjectBtn = document.getElementById('delete-project-btn');
      const deleteModal = document.getElementById('delete-modal');
      const cancelDelete = document.getElementById('cancel-delete');
      const confirmDelete = document.getElementById('confirm-delete');
      const deleteProjectForm = document.getElementById('delete-project-form');

      deleteProjectBtn.addEventListener('click', function() {
        deleteModal.classList.add('active');
      });

      cancelDelete.addEventListener('click', function() {
        deleteModal.classList.remove('active');
      });

      // Disable submit button on form submission
      deleteProjectForm.addEventListener('submit', function(e) {
        confirmDelete.disabled = true;
        confirmDelete.textContent = 'Deleting...';
      });

      // Close modal when clicking outside
      deleteModal.addEventListener('click', function(e) {
        if (e.target === deleteModal) {
          deleteModal.classList.remove('active');
        }
      });

      // HTMX event listeners for invite form
      document.body.addEventListener('htmx:beforeRequest', function(evt) {
        if (evt.detail.elt.id === 'inviteForm') {
          // Disable the send invite button
          sendInviteBtn.disabled = true;
          sendInviteBtn.querySelector('.btn-text').textContent = 'Sending...';
          sendInviteBtn.classList.add('opacity-70');

          // Clear previous results
          inviteResult.innerHTML = '';
        }
      });

      document.body.addEventListener('htmx:afterRequest', function(evt) {
        if (evt.detail.elt.id === 'inviteForm') {
          // Re-enable the button after request completes
          sendInviteBtn.disabled = false;
          sendInviteBtn.classList.remove('opacity-70');
          sendInviteBtn.querySelector('.btn-text').textContent = 'Send Invite';

          if (evt.detail.successful) {
            // Clear form on success
            inviteEmailInput.value = '';
            inviteEmailInput.classList.remove('input-valid');
            validationIcon.classList.add('hidden');
            sendInviteBtn.disabled = true;

            // Auto-dismiss success message
            const successMessage = inviteResult.querySelector('.invite-message');
            autoDismissMessage(successMessage);
          } else {
            // Auto-dismiss error message
            const errorMessage = inviteResult.querySelector('.invite-message');
            autoDismissMessage(errorMessage);
          }
        }
      });

      // Handle HTMX response to add auto-dismiss functionality
      document.body.addEventListener('htmx:beforeSwap', function(evt) {
        if (evt.detail.target.id === 'invite-result') {
          // Add auto-dismiss class to any message in the response
          const responseDoc = new DOMParser().parseFromString(evt.detail.xhr.responseText, 'text/html');
          const message = responseDoc.querySelector('.invite-message');

          if (message) {
            // Add the auto-dismiss class to the response
            message.classList.add('message-fade-out');
          }
        }
      });
    });
  </script>
</div>
</body>
</html>